<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>INKredible — Financial Command Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Plus+Jakarta+Sans:wght@500;600;700;800&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ===== ORIGIN DESIGN SYSTEM — Financial Command Center ===== */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg: #0a0a0f;
            --text: #ffffff;
            --text-secondary: rgba(255,255,255,0.6);
            --text-muted: rgba(255,255,255,0.38);
            --accent-teal: #13B0C9;
            --accent-teal-deep: #0E8EA7;
            --accent-green: #22A85F;
            --accent-red: #E04848;
            --accent-amber: #F59E0B;
            --accent-purple: #8E87FF;
            --accent-rose: #D47EB8;
            --glass: rgba(255,255,255,0.05);
            --glass-border: rgba(255,255,255,0.1);
            --glass-hover: rgba(255,255,255,0.08);
            --card-bg: rgba(255,255,255,0.04);
            --font-display: 'Plus Jakarta Sans','Inter',-apple-system,sans-serif;
            --font-body: 'Inter',-apple-system,sans-serif;
            --font-mono: 'Roboto Mono',monospace;
        }

        [data-theme="light"] {
            --bg: #f7f8fa;
            --text: #1a1d23;
            --text-secondary: rgba(26,29,35,0.65);
            --text-muted: rgba(26,29,35,0.42);
            --accent-teal: #0097B2;
            --accent-green: #1B9E55;
            --accent-red: #D43B3B;
            --accent-amber: #C4962E;
            --accent-purple: #6C63FF;
            --glass: rgba(255,255,255,0.75);
            --glass-border: rgba(0,0,0,0.08);
            --glass-hover: rgba(255,255,255,0.9);
            --card-bg: rgba(255,255,255,0.8);
        }

        body {
            font-family: var(--font-body);
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 16px;
            padding-bottom: 80px;
            -webkit-font-smoothing: antialiased;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
            background:
                radial-gradient(ellipse 60% 50% at 10% 12%, rgba(19,176,201,0.08), transparent 55%),
                radial-gradient(ellipse 55% 55% at 85% 10%, rgba(142,135,255,0.07), transparent 50%),
                radial-gradient(ellipse 50% 60% at 70% 80%, rgba(212,126,184,0.04), transparent 50%);
            filter: blur(6px);
        }

        [data-theme="light"] body::before {
            background:
                radial-gradient(ellipse 60% 50% at 10% 12%, rgba(0,151,178,0.05), transparent 55%),
                radial-gradient(ellipse 55% 55% at 85% 10%, rgba(108,99,255,0.05), transparent 50%);
        }

        .container { max-width: 900px; margin: 0 auto; position: relative; z-index: 1; }

        /* ===== HEADER ===== */
        header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 16px;
            border-bottom: 1px solid var(--glass-border);
        }

        h1 { font-family: var(--font-display); font-size: clamp(1.2rem,4vw,1.6rem); font-weight: 700; letter-spacing: -0.02em; }
        h1 em { color: var(--accent-teal); font-style: normal; }
        h1 .sub { display: block; font-size: 0.5em; font-weight: 500; color: var(--text-muted); letter-spacing: 0.06em; text-transform: uppercase; margin-top: 4px; }

        .header-actions { display: flex; gap: 8px; align-items: center; }

        .btn-icon {
            width: 36px; height: 36px; border-radius: 50%; border: 1px solid var(--glass-border);
            background: var(--glass); color: var(--text-secondary); cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: all 0.2s;
        }
        .btn-icon:hover { background: var(--glass-hover); color: var(--text); }
        .btn-icon svg { width: 18px; height: 18px; stroke: currentColor; fill: none; stroke-width: 1.8; stroke-linecap: round; stroke-linejoin: round; }

        /* ===== STATUS BAR ===== */
        .status-bar {
            display: flex; gap: 8px; align-items: center; flex-wrap: wrap;
            padding: 10px 16px; border-radius: 12px;
            background: var(--glass); border: 1px solid var(--glass-border);
            margin-bottom: 20px; font-size: 0.8rem;
        }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
        .status-dot.green { background: var(--accent-green); box-shadow: 0 0 8px rgba(34,168,95,0.4); }
        .status-dot.amber { background: var(--accent-amber); box-shadow: 0 0 8px rgba(245,158,11,0.4); }
        .status-dot.red { background: var(--accent-red); box-shadow: 0 0 8px rgba(224,72,72,0.4); }
        .status-text { color: var(--text-secondary); }
        .status-text strong { color: var(--text); }

        /* ===== GRID ===== */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px; }
        @media (max-width: 640px) { .grid-2 { grid-template-columns: 1fr; } }

        /* ===== PANELS ===== */
        .panel {
            background: var(--glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: 16px; padding: 20px;
            transition: all 0.3s ease;
        }
        .panel:hover { border-color: rgba(255,255,255,0.18); }
        [data-theme="light"] .panel:hover { border-color: rgba(0,0,0,0.15); }

        .panel-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 16px;
        }
        .panel-title {
            font-family: var(--font-display); font-size: 0.85rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-secondary);
        }
        .panel-icon { font-size: 1.1rem; }

        /* ===== METRICS ===== */
        .metric-big {
            font-family: var(--font-mono); font-size: clamp(1.6rem,5vw,2.2rem);
            font-weight: 700; letter-spacing: -0.02em; line-height: 1;
        }
        .metric-label { font-size: 0.75rem; color: var(--text-muted); margin-top: 4px; }
        .metric-row { display: flex; justify-content: space-between; align-items: baseline; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.04); }
        [data-theme="light"] .metric-row { border-bottom-color: rgba(0,0,0,0.04); }
        .metric-row:last-child { border-bottom: none; }
        .metric-row .label { font-size: 0.82rem; color: var(--text-secondary); }
        .metric-row .value { font-family: var(--font-mono); font-size: 0.9rem; font-weight: 600; }

        .positive { color: var(--accent-green); }
        .negative { color: var(--accent-red); }
        .warning { color: var(--accent-amber); }
        .neutral { color: var(--text-secondary); }

        /* ===== PROGRESS BAR ===== */
        .progress-wrap { margin-top: 12px; }
        .progress-bar { height: 8px; border-radius: 4px; background: rgba(255,255,255,0.08); overflow: hidden; position: relative; }
        [data-theme="light"] .progress-bar { background: rgba(0,0,0,0.06); }
        .progress-fill { height: 100%; border-radius: 4px; transition: width 0.6s ease; }
        .progress-labels { display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-muted); margin-top: 4px; }

        /* ===== DEBT TABLE ===== */
        .debt-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
        .debt-table th {
            text-align: left; font-size: 0.7rem; font-weight: 600; text-transform: uppercase;
            letter-spacing: 0.04em; color: var(--text-muted); padding: 6px 8px;
            border-bottom: 1px solid var(--glass-border);
        }
        .debt-table td {
            font-size: 0.82rem; padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.03);
            color: var(--text-secondary);
        }
        [data-theme="light"] .debt-table td { border-bottom-color: rgba(0,0,0,0.04); }
        .debt-table td.mono { font-family: var(--font-mono); font-weight: 500; color: var(--text); }
        .debt-table tr.target td { background: rgba(19,176,201,0.06); }
        .debt-rank { display: inline-flex; align-items: center; justify-content: center; width: 20px; height: 20px; border-radius: 50%; font-size: 0.65rem; font-weight: 700; }
        .debt-rank.r1 { background: var(--accent-red); color: #fff; }
        .debt-rank.r2 { background: var(--accent-amber); color: #000; }
        .debt-rank.r3 { background: var(--accent-teal); color: #fff; }

        /* ===== SCOREBOARD ===== */
        .scoreboard {
            background: var(--glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: 16px; padding: 20px;
            margin-bottom: 20px;
        }
        .scoreboard-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 16px;
        }
        .scoreboard-title {
            font-family: var(--font-display); font-size: 1rem; font-weight: 700;
        }
        .scoreboard-date { font-size: 0.75rem; color: var(--text-muted); }
        .scoreboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
        .sb-card {
            background: var(--card-bg); border: 1px solid var(--glass-border);
            border-radius: 12px; padding: 14px; text-align: center;
        }
        .sb-value { font-family: var(--font-mono); font-size: 1.3rem; font-weight: 700; }
        .sb-label { font-size: 0.7rem; color: var(--text-muted); margin-top: 4px; }

        /* ===== ACTION ITEMS ===== */
        .actions-list { list-style: none; margin-top: 12px; }
        .actions-list li {
            display: flex; align-items: flex-start; gap: 10px;
            padding: 10px 12px; border-radius: 10px; margin-bottom: 6px;
            background: var(--card-bg); border: 1px solid var(--glass-border);
            font-size: 0.85rem; color: var(--text-secondary);
        }
        .actions-list .icon { font-size: 1rem; flex-shrink: 0; margin-top: 1px; }
        .actions-list .priority-high .icon { color: var(--accent-red); }
        .actions-list .priority-med .icon { color: var(--accent-amber); }
        .actions-list .priority-low .icon { color: var(--accent-teal); }

        /* ===== CASH LOG ===== */
        .cash-log-section { margin-bottom: 20px; }
        .add-btn {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 8px 16px; border-radius: 10px;
            background: var(--accent-teal); color: #fff; border: none;
            font-size: 0.82rem; font-weight: 600; cursor: pointer;
            transition: all 0.2s;
        }
        .add-btn:hover { filter: brightness(1.1); transform: translateY(-1px); }

        .log-entries { margin-top: 12px; }
        .log-entry {
            display: grid; grid-template-columns: auto 1fr auto auto; gap: 8px; align-items: center;
            padding: 8px 12px; border-radius: 8px; margin-bottom: 4px;
            background: var(--card-bg); border: 1px solid var(--glass-border);
            font-size: 0.82rem;
        }
        .log-entry .date { font-family: var(--font-mono); font-size: 0.75rem; color: var(--text-muted); }
        .log-entry .desc { color: var(--text-secondary); }
        .log-entry .amount { font-family: var(--font-mono); font-weight: 600; }
        .log-entry .del-btn { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 0.9rem; padding: 2px; }
        .log-entry .del-btn:hover { color: var(--accent-red); }

        /* ===== MODAL ===== */
        .modal-overlay {
            display: none; position: fixed; inset: 0; z-index: 9999;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
            align-items: center; justify-content: center; padding: 16px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: var(--bg); border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 24px; max-width: 420px; width: 100%;
            max-height: 90vh; overflow-y: auto;
        }
        .modal h2 { font-family: var(--font-display); font-size: 1.1rem; margin-bottom: 16px; }
        .modal label { display: block; font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 4px; margin-top: 12px; }
        .modal input, .modal select, .modal textarea {
            width: 100%; padding: 10px 12px; border-radius: 10px;
            border: 1px solid var(--glass-border); background: var(--glass);
            color: var(--text); font-family: var(--font-body); font-size: 0.9rem;
        }
        .modal input:focus, .modal select:focus, .modal textarea:focus {
            outline: none; border-color: var(--accent-teal);
        }
        .modal-actions { display: flex; gap: 8px; margin-top: 20px; }
        .modal-actions button {
            flex: 1; padding: 10px; border-radius: 10px; font-weight: 600;
            font-size: 0.85rem; cursor: pointer; transition: all 0.2s;
        }
        .btn-save { background: var(--accent-teal); color: #fff; border: none; }
        .btn-save:hover { filter: brightness(1.1); }
        .btn-cancel { background: transparent; color: var(--text-secondary); border: 1px solid var(--glass-border); }
        .btn-cancel:hover { background: var(--glass); }

        /* ===== RISK ALERTS ===== */
        .risk-alert {
            display: flex; align-items: flex-start; gap: 10px;
            padding: 12px 16px; border-radius: 12px; margin-bottom: 8px;
            font-size: 0.82rem;
        }
        .risk-alert.red { background: rgba(224,72,72,0.08); border: 1px solid rgba(224,72,72,0.2); color: var(--accent-red); }
        .risk-alert.amber { background: rgba(245,158,11,0.08); border: 1px solid rgba(245,158,11,0.2); color: var(--accent-amber); }
        .risk-alert.green { background: rgba(34,168,95,0.08); border: 1px solid rgba(34,168,95,0.2); color: var(--accent-green); }

        /* ===== WEEKLY WIN ===== */
        .weekly-win {
            background: linear-gradient(135deg, rgba(34,168,95,0.08), rgba(19,176,201,0.06));
            border: 1px solid rgba(34,168,95,0.15); border-radius: 12px;
            padding: 14px 16px; margin-top: 12px;
            font-size: 0.85rem; color: var(--accent-green);
        }
        .weekly-win .win-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; opacity: 0.7; margin-bottom: 4px; }

        /* ===== FOOTER NAV ===== */
        .footer-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--bg); border-top: 1px solid var(--glass-border);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            display: flex; justify-content: center; gap: 4px;
            padding: 8px 16px; z-index: 9000;
        }
        .nav-btn {
            flex: 1; max-width: 100px; padding: 6px 4px; border: none;
            background: transparent; color: var(--text-muted); cursor: pointer;
            border-radius: 8px; font-size: 0.65rem; text-align: center;
            transition: all 0.2s;
        }
        .nav-btn.active { color: var(--accent-teal); background: rgba(19,176,201,0.08); }
        .nav-btn:hover { color: var(--text); }
        .nav-btn .nav-icon { font-size: 1.2rem; display: block; margin-bottom: 2px; }

        /* ===== SECTIONS ===== */
        .section { display: none; }
        .section.active { display: block; }

        /* ===== EDIT DEBT MODAL EXTRAS ===== */
        .debt-edit-row {
            display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 6px;
            align-items: center; padding: 6px 0; font-size: 0.8rem;
        }
        .debt-edit-row input { padding: 6px 8px; font-size: 0.8rem; }
        .debt-edit-row .del-btn { width: 28px; height: 28px; }

        @media (max-width: 640px) {
            .debt-edit-row { grid-template-columns: 1fr 1fr; }
        }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.3s ease forwards; }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header>
            <h1><em>Financial</em> Command Center <span class="sub">INKredible Printing</span></h1>
            <div class="header-actions">
                <button class="btn-icon" onclick="refreshData()" title="Refresh">
                    <svg><path d="M1 4v6h6"/><path d="M23 20v-6h-6"/><path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/></svg>
                </button>
                <button class="btn-icon" onclick="toggleTheme()" title="Toggle theme">
                    <svg class="theme-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                </button>
            </div>
        </header>

        <!-- STATUS BAR -->
        <div class="status-bar" id="statusBar">
            <div class="status-dot" id="statusDot"></div>
            <span class="status-text" id="statusText">Loading...</span>
        </div>

        <!-- ==================== SECTION: OVERVIEW ==================== -->
        <div class="section active" id="sec-overview">
            <!-- Top Metrics: Cash + Debt -->
            <div class="grid-2">
                <!-- CASH CONTROL -->
                <div class="panel fade-in">
                    <div class="panel-header">
                        <span class="panel-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg> Cash Control</span>
                    </div>
                    <div class="metric-big" id="cashPosition">—</div>
                    <div class="metric-label">Real Cash Position</div>
                    <div class="progress-wrap">
                        <div class="progress-bar">
                            <div class="progress-fill" id="reserveFill" style="width:0%;background:var(--accent-green);"></div>
                        </div>
                        <div class="progress-labels">
                            <span>Reserve: <span id="reservePct">—</span></span>
                            <span>Target: <span id="reserveTarget">$26K</span></span>
                        </div>
                    </div>
                    <div style="margin-top:12px;">
                        <div class="metric-row"><span class="label">Bank (QB)</span><span class="value" id="bankBalance">—</span></div>
                        <div class="metric-row"><span class="label">Off-books Cash</span><span class="value" id="offbooksCash">—</span></div>
                        <div class="metric-row"><span class="label">Overdue A/R</span><span class="value warning" id="overdueAR">—</span></div>
                    </div>
                </div>

                <!-- DEBT WATERFALL -->
                <div class="panel fade-in">
                    <div class="panel-header">
                        <span class="panel-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 22 12 2l10 20Z"/><path d="M12 14v4"/><path d="M12 10h.01"/></svg> Debt Waterfall</span>
                        <button class="btn-icon" onclick="openDebtModal()" title="Edit debts" style="width:28px;height:28px;">
                            <svg style="width:14px;height:14px;"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                        </button>
                    </div>
                    <div class="metric-big negative" id="totalDebt">—</div>
                    <div class="metric-label">Total Debt Outstanding</div>
                    <div style="margin-top:12px;">
                        <div class="metric-row"><span class="label">Monthly Interest</span><span class="value negative" id="monthlyInterest">—</span></div>
                        <div class="metric-row"><span class="label">WoW Change</span><span class="value" id="debtWoW">—</span></div>
                        <div class="metric-row"><span class="label">#1 Target</span><span class="value" id="debtTarget" style="color:var(--accent-teal);">—</span></div>
                    </div>
                </div>
            </div>

            <!-- Bottom Metrics: Margin + Floor Graphics -->
            <div class="grid-2">
                <!-- MARGIN HEALTH -->
                <div class="panel fade-in">
                    <div class="panel-header">
                        <span class="panel-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg> Margin Health</span>
                    </div>
                    <div class="metric-big" id="grossMargin" style="color:var(--accent-green);">—</div>
                    <div class="metric-label">Gross Margin (Current Period)</div>
                    <div style="margin-top:12px;">
                        <div class="metric-row"><span class="label">Revenue</span><span class="value" id="revenue">—</span></div>
                        <div class="metric-row"><span class="label">COGS</span><span class="value" id="cogs">—</span></div>
                        <div class="metric-row"><span class="label">Gross Profit</span><span class="value positive" id="grossProfit">—</span></div>
                        <div class="metric-row"><span class="label">Net Income</span><span class="value" id="netIncome">—</span></div>
                    </div>
                </div>

                <!-- FLOOR GRAPHICS SHARE -->
                <div class="panel fade-in">
                    <div class="panel-header">
                        <span class="panel-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg> Floor Graphics</span>
                    </div>
                    <div class="metric-big" id="floorShare" style="color:var(--accent-purple);">—</div>
                    <div class="metric-label">Share of Revenue (Target: ≥40%)</div>
                    <div class="progress-wrap">
                        <div class="progress-bar">
                            <div class="progress-fill" id="floorFill" style="width:0%;background:var(--accent-purple);"></div>
                        </div>
                        <div class="progress-labels">
                            <span>Current</span>
                            <span>Target: 40%</span>
                        </div>
                    </div>
                    <div style="margin-top:12px;">
                        <div class="metric-row"><span class="label">Floor Revenue</span><span class="value" id="floorRevenue">—</span></div>
                        <div class="metric-row"><span class="label">Jobs This Period</span><span class="value" id="floorJobs">—</span></div>
                        <div class="metric-row"><span class="label">Avg Job Value</span><span class="value" id="floorAvg">—</span></div>
                    </div>
                </div>
            </div>

            <!-- RISK ALERTS -->
            <div id="riskAlerts" style="margin-bottom:20px;"></div>

            <!-- WEEKLY WIN -->
            <div class="weekly-win" id="weeklyWin" style="display:none;">
                <div class="win-label">This Week's Win</div>
                <div id="winText"></div>
            </div>
        </div>

        <!-- ==================== SECTION: SCOREBOARD ==================== -->
        <div class="section" id="sec-scoreboard">
            <div class="scoreboard">
                <div class="scoreboard-header">
                    <span class="scoreboard-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg> Weekly Scoreboard</span>
                    <span class="scoreboard-date" id="scoreboardDate">—</span>
                </div>
                <div class="scoreboard-grid" id="scoreboardGrid"></div>
            </div>

            <!-- This Week's 3 Moves -->
            <div class="panel" style="margin-bottom:20px;">
                <div class="panel-header">
                    <span class="panel-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg> This Week's 3 Moves</span>
                </div>
                <ul class="actions-list" id="weeklyActions"></ul>
            </div>
        </div>

        <!-- ==================== SECTION: CASH LOG ==================== -->
        <div class="section" id="sec-cashlog">
            <div class="panel cash-log-section">
                <div class="panel-header">
                    <span class="panel-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="6" width="20" height="12" rx="2"/><circle cx="12" cy="12" r="2"/><path d="M6 12h.01M18 12h.01"/></svg> Off-Books Cash Log</span>
                    <button class="add-btn" onclick="openCashModal()">+ Add</button>
                </div>
                <div style="font-size:0.78rem;color:var(--text-muted);margin-bottom:12px;">
                    Log every cash payment here. Undeposited cash >7 days triggers a red alert.
                </div>
                <div class="log-entries" id="cashLogEntries">
                    <div style="color:var(--text-muted);font-size:0.85rem;text-align:center;padding:20px;">No entries yet. Tap + Add to start logging.</div>
                </div>
                <div class="metric-row" style="margin-top:12px;padding-top:12px;border-top:1px solid var(--glass-border);">
                    <span class="label" style="font-weight:600;">Total Undeposited</span>
                    <span class="value positive" id="totalUndeposited">$0</span>
                </div>
            </div>
        </div>

        <!-- ==================== SECTION: DEBTS ==================== -->
        <div class="section" id="sec-debts">
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 22 12 2l10 20Z"/><path d="M12 14v4"/><path d="M12 10h.01"/></svg> Debt Waterfall (Full View)</span>
                    <button class="add-btn" onclick="openDebtModal()">Edit</button>
                </div>
                <div style="font-size:0.78rem;color:var(--text-muted);margin-bottom:12px;">
                    Ranked by APR (highest first). #1 gets all extra payments after reserve is met.
                </div>
                <div style="overflow-x:auto;">
                    <table class="debt-table" id="debtTableFull">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Lender</th>
                                <th>Type</th>
                                <th>Balance</th>
                                <th>APR</th>
                                <th>Min Pmt</th>
                                <th>Mo. Interest</th>
                            </tr>
                        </thead>
                        <tbody id="debtBodyFull"></tbody>
                    </table>
                </div>
                <div class="metric-row" style="margin-top:12px;padding-top:12px;border-top:1px solid var(--glass-border);">
                    <span class="label" style="font-weight:600;">Reserve Rule</span>
                    <span class="value" id="reserveRule" style="font-size:0.8rem;">—</span>
                </div>
            </div>
        </div>
    </div>

    <!-- BOTTOM NAV -->
    <nav class="footer-nav">
        <button class="nav-btn active" onclick="showSection('overview')" id="nav-overview">
            <span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg></span>Overview
        </button>
        <button class="nav-btn" onclick="showSection('scoreboard')" id="nav-scoreboard">
            <span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></span>Scoreboard
        </button>
        <button class="nav-btn" onclick="showSection('cashlog')" id="nav-cashlog">
            <span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="6" width="20" height="12" rx="2"/><circle cx="12" cy="12" r="2"/><path d="M6 12h.01M18 12h.01"/></svg></span>Cash Log
        </button>
        <button class="nav-btn" onclick="showSection('debts')" id="nav-debts">
            <span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 22 12 2l10 20Z"/><path d="M12 14v4"/><path d="M12 10h.01"/></svg></span>Debts
        </button>
    </nav>

    <!-- CASH ENTRY MODAL -->
    <div class="modal-overlay" id="cashModal">
        <div class="modal">
            <h2><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="6" width="20" height="12" rx="2"/><circle cx="12" cy="12" r="2"/><path d="M6 12h.01M18 12h.01"/></svg> Log Cash Payment</h2>
            <label>Date</label>
            <input type="date" id="cashDate">
            <label>Customer / Description</label>
            <input type="text" id="cashDesc" placeholder="e.g. Walk-in customer">
            <label>Amount ($)</label>
            <input type="number" id="cashAmount" placeholder="0.00" step="0.01" min="0">
            <label>Job Type</label>
            <select id="cashJobType">
                <option value="floor_graphics">Floor Graphics</option>
                <option value="small_format">Small Format</option>
                <option value="wide_format">Wide Format</option>
                <option value="other">Other</option>
            </select>
            <label>Notes (optional)</label>
            <textarea id="cashNotes" rows="2" placeholder="e.g. paid cash at pickup"></textarea>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeCashModal()">Cancel</button>
                <button class="btn-save" onclick="saveCashEntry()">Save</button>
            </div>
        </div>
    </div>

    <!-- DEBT EDIT MODAL -->
    <div class="modal-overlay" id="debtModal">
        <div class="modal" style="max-width:520px;">
            <h2>Edit Debt Register</h2>
            <div style="font-size:0.78rem;color:var(--text-muted);margin-bottom:12px;">
                Enter all debts with their current balance, APR, and minimum payment.
            </div>
            <div id="debtEditList"></div>
            <button class="add-btn" onclick="addDebtRow()" style="margin-top:12px;">+ Add Debt</button>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeDebtModal()">Cancel</button>
                <button class="btn-save" onclick="saveDebts()">Save All</button>
            </div>
        </div>
    </div>

    <script>
        // ===== THEME =====
        const saved = localStorage.getItem('fcc-theme') || 'light';
        document.documentElement.setAttribute('data-theme', saved);
        function toggleTheme() {
            const isDark = document.documentElement.getAttribute('data-theme') !== 'light';
            const t = isDark ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', t);
            localStorage.setItem('fcc-theme', t);
        }

        // ===== NAVIGATION =====
        function showSection(name) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('sec-' + name).classList.add('active');
            document.getElementById('nav-' + name).classList.add('active');
        }

        // ===== DATA STORE =====
        const STORE_DEBTS = 'fcc-debts';
        const STORE_CASH = 'fcc-cash-log';
        const STORE_WIN = 'fcc-weekly-win';
        const STORE_FLOOR = 'fcc-floor-data';

        // Default debts from INKredible's known debt profile
        const DEFAULT_DEBTS = [
            { lender: 'Credit Cards (Various)', type: 'credit_card', balance: 71000, apr: 24.99, minPmt: 1800, status: 'active' },
            { lender: 'Chase LOC', type: 'loc', balance: 43000, apr: 17.5, minPmt: 502, status: 'active' },
            { lender: 'Loan Payable', type: 'term_loan', balance: 60000, apr: 8.0, minPmt: 950, status: 'active' }
        ];

        function loadDebts() {
            const stored = localStorage.getItem(STORE_DEBTS);
            if (stored) return JSON.parse(stored);
            return DEFAULT_DEBTS;
        }
        function saveDebtsToStore(debts) { localStorage.setItem(STORE_DEBTS, JSON.stringify(debts)); }

        function loadCashLog() {
            const stored = localStorage.getItem(STORE_CASH);
            return stored ? JSON.parse(stored) : [];
        }
        function saveCashLogToStore(log) { localStorage.setItem(STORE_CASH, JSON.stringify(log)); }

        function loadFloorData() {
            const stored = localStorage.getItem(STORE_FLOOR);
            return stored ? JSON.parse(stored) : { revenue: 0, jobs: 0 };
        }

        // ===== FORMAT HELPERS =====
        const fmt = (n) => {
            if (n === null || n === undefined || isNaN(n)) return '—';
            const abs = Math.abs(n);
            if (abs >= 1000) return (n < 0 ? '-' : '') + '$' + (abs / 1000).toFixed(abs >= 10000 ? 0 : 1) + 'K';
            return (n < 0 ? '-' : '') + '$' + abs.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        };
        const fmtFull = (n) => {
            if (n === null || n === undefined || isNaN(n)) return '—';
            return (n < 0 ? '-' : '') + '$' + Math.abs(n).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        };
        const fmtPct = (n) => (n === null || n === undefined || isNaN(n)) ? '—' : n.toFixed(1) + '%';

        // ===== QUICKBOOKS DATA =====
        let qbData = null;

        async function fetchQBData() {
            try {
                const resp = await fetch('data/quickbooks-live.json?_=' + Date.now());
                if (resp.ok) {
                    qbData = await resp.json();
                    return true;
                }
            } catch (e) { console.warn('QB fetch failed:', e); }

            // Try sample data
            try {
                const resp = await fetch('data/quickbooks-sample.json?_=' + Date.now());
                if (resp.ok) { qbData = await resp.json(); return true; }
            } catch (e) {}

            return false;
        }

        // ===== RENDER =====
        async function refreshData() {
            const ok = await fetchQBData();
            const debts = loadDebts();
            const cashLog = loadCashLog();
            const floorData = loadFloorData();

            // Sort debts by APR descending
            debts.sort((a, b) => b.apr - a.apr);

            // ---- CALCULATIONS ----
            const totalDebt = debts.reduce((s, d) => s + (d.balance || 0), 0);
            const monthlyInterest = debts.reduce((s, d) => s + ((d.balance || 0) * (d.apr || 0) / 100 / 12), 0);
            const totalMinPmt = debts.reduce((s, d) => s + (d.minPmt || 0), 0);
            const topTarget = debts.length > 0 ? debts[0] : null;

            // Cash position
            const undepositedCash = cashLog.filter(e => !e.deposited).reduce((s, e) => s + (e.amount || 0), 0);
            let bankBalance = null;
            let overdueAR = null;
            let income = null, cogs = null, grossProfit = null, netIncome = null, grossMarginPct = null;

            if (qbData && qbData.metrics) {
                const m = qbData.metrics;
                // Use total equity as a rough bank proxy or currentAssets
                bankBalance = m.currentAssets || m.totalAssets || null;
                overdueAR = m.overdueInvoicesBalance || null;
                income = m.income;
                cogs = m.cogs;
                grossProfit = m.grossProfit;
                netIncome = m.netIncome;
                grossMarginPct = m.grossMarginPct;
            }

            // Real cash position = bank + undeposited cash
            const realCash = (bankBalance || 0) + undepositedCash;
            // Reserve targets from spec
            const reserveFloor = 20000;
            const reserveTargetVal = 26000;
            const reserveCoverage = reserveTargetVal > 0 ? (realCash / reserveTargetVal * 100) : 0;

            // Floor graphics (from localStorage or estimate)
            const floorRevenue = floorData.revenue || 0;
            const floorJobs = floorData.jobs || 0;
            const floorSharePct = income > 0 ? (floorRevenue / income * 100) : 0;
            const floorAvgJob = floorJobs > 0 ? (floorRevenue / floorJobs) : 0;

            // ---- STATUS BAR ----
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            if (realCash >= reserveTargetVal) {
                statusDot.className = 'status-dot green';
                statusText.innerHTML = 'Reserve target met — <strong>safe to attack debt</strong>';
            } else if (realCash >= reserveFloor) {
                statusDot.className = 'status-dot amber';
                statusText.innerHTML = 'Above reserve floor — <strong>building toward target</strong>';
            } else {
                statusDot.className = 'status-dot red';
                statusText.innerHTML = 'Below reserve floor — <strong>all surplus to reserve</strong>';
            }

            // ---- CASH CONTROL ----
            document.getElementById('cashPosition').textContent = fmt(realCash);
            document.getElementById('cashPosition').className = 'metric-big ' + (realCash < 0 ? 'negative' : realCash < reserveFloor ? 'warning' : 'positive');
            document.getElementById('reservePct').textContent = fmtPct(reserveCoverage);
            document.getElementById('reserveTarget').textContent = fmt(reserveTargetVal);
            document.getElementById('reserveFill').style.width = Math.min(100, Math.max(0, reserveCoverage)) + '%';
            document.getElementById('reserveFill').style.background = reserveCoverage >= 100 ? 'var(--accent-green)' : reserveCoverage >= 75 ? 'var(--accent-amber)' : 'var(--accent-red)';
            document.getElementById('bankBalance').textContent = bankBalance !== null ? fmtFull(bankBalance) : '—';
            document.getElementById('offbooksCash').textContent = fmtFull(undepositedCash);
            document.getElementById('overdueAR').textContent = overdueAR !== null ? fmtFull(overdueAR) : '—';

            // ---- DEBT WATERFALL ----
            document.getElementById('totalDebt').textContent = fmt(totalDebt);
            document.getElementById('monthlyInterest').textContent = fmt(monthlyInterest) + '/mo';
            document.getElementById('debtWoW').textContent = '—'; // needs historical data
            document.getElementById('debtTarget').textContent = topTarget ? topTarget.lender : '—';

            // ---- MARGIN HEALTH ----
            document.getElementById('grossMargin').textContent = grossMarginPct !== null ? fmtPct(grossMarginPct) : '—';
            document.getElementById('grossMargin').className = 'metric-big ' + (grossMarginPct !== null ? (grossMarginPct >= 54 ? 'positive' : grossMarginPct >= 40 ? 'warning' : 'negative') : '');
            document.getElementById('revenue').textContent = income !== null ? fmtFull(income) : '—';
            document.getElementById('cogs').textContent = cogs !== null ? fmtFull(cogs) : '—';
            document.getElementById('grossProfit').textContent = grossProfit !== null ? fmtFull(grossProfit) : '—';
            document.getElementById('netIncome').textContent = netIncome !== null ? fmtFull(netIncome) : '—';
            document.getElementById('netIncome').className = 'value ' + (netIncome !== null ? (netIncome >= 0 ? 'positive' : 'negative') : '');

            // ---- FLOOR GRAPHICS ----
            document.getElementById('floorShare').textContent = floorSharePct > 0 ? fmtPct(floorSharePct) : 'Track jobs →';
            document.getElementById('floorFill').style.width = Math.min(100, Math.max(0, floorSharePct / 40 * 100)) + '%';
            document.getElementById('floorRevenue').textContent = floorRevenue > 0 ? fmtFull(floorRevenue) : 'Not tracked yet';
            document.getElementById('floorJobs').textContent = floorJobs > 0 ? floorJobs : '—';
            document.getElementById('floorAvg').textContent = floorAvgJob > 0 ? fmtFull(floorAvgJob) : '—';

            // ---- RISK ALERTS ----
            const alerts = [];
            if (realCash < reserveFloor) alerts.push({ level: 'red', text: `Cash ($${realCash.toLocaleString()}) below reserve floor ($${reserveFloor.toLocaleString()}). Freeze extra debt payments.` });
            if (overdueAR && overdueAR > 3000) alerts.push({ level: 'amber', text: `$${overdueAR.toLocaleString()} in overdue invoices. Follow up on collections.` });
            if (monthlyInterest > 2000) alerts.push({ level: 'red', text: `Monthly interest burn: $${monthlyInterest.toFixed(0)}. Refinance check needed for ${topTarget ? topTarget.lender : 'top debt'}.` });
            if (grossMarginPct !== null && grossMarginPct < 50) alerts.push({ level: 'amber', text: `Gross margin at ${grossMarginPct.toFixed(1)}% — below 54.5% target. Review COGS/pricing.` });
            const staleEntries = cashLog.filter(e => !e.deposited && daysSince(e.date) > 7);
            if (staleEntries.length > 0) alerts.push({ level: 'red', text: `${staleEntries.length} cash entries undeposited >7 days. Reconcile or deposit.` });
            if (alerts.length === 0) alerts.push({ level: 'green', text: 'No critical alerts. Keep executing the plan.' });

            const alertsHtml = alerts.map(a => `<div class="risk-alert ${a.level}"><span>${a.level === 'red' ? '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>' : a.level === 'amber' ? '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/></svg>' : '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>'}</span><span>${a.text}</span></div>`).join('');
            document.getElementById('riskAlerts').innerHTML = alertsHtml;

            // ---- WEEKLY WIN ----
            const winStore = localStorage.getItem(STORE_WIN);
            if (winStore) {
                const win = JSON.parse(winStore);
                document.getElementById('weeklyWin').style.display = 'block';
                document.getElementById('winText').textContent = win.text;
            }

            // ---- SCOREBOARD ----
            renderScoreboard(realCash, reserveCoverage, reserveTargetVal, totalDebt, monthlyInterest, grossMarginPct, grossProfit, income, floorSharePct);

            // ---- DEBT TABLE (full view) ----
            renderDebtTable(debts);

            // ---- CASH LOG ----
            renderCashLog(cashLog);

            // ---- WEEKLY ACTIONS ----
            renderWeeklyActions(realCash, reserveFloor, topTarget, overdueAR, staleEntries.length);
        }

        function daysSince(dateStr) {
            if (!dateStr) return 999;
            const d = new Date(dateStr);
            const now = new Date();
            return Math.floor((now - d) / (1000 * 60 * 60 * 24));
        }

        // ---- SCOREBOARD ----
        function renderScoreboard(cash, reservePct, reserveTarget, debt, interest, margin, grossProfit, revenue, floorPct) {
            const now = new Date();
            const weekStart = new Date(now); weekStart.setDate(now.getDate() - now.getDay());
            const weekEnd = new Date(weekStart); weekEnd.setDate(weekStart.getDate() + 6);
            document.getElementById('scoreboardDate').textContent =
                weekStart.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ' – ' +
                weekEnd.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

            const items = [
                { label: 'Cash Position', value: fmt(cash), cls: cash >= reserveTarget ? 'positive' : cash >= 0 ? 'warning' : 'negative' },
                { label: 'Reserve %', value: fmtPct(reservePct), cls: reservePct >= 100 ? 'positive' : reservePct >= 75 ? 'warning' : 'negative' },
                { label: 'Total Debt', value: fmt(debt), cls: 'negative' },
                { label: 'Mo. Interest', value: fmt(interest), cls: 'negative' },
                { label: 'Gross Margin', value: margin !== null ? fmtPct(margin) : '—', cls: margin >= 54 ? 'positive' : margin >= 40 ? 'warning' : 'negative' },
                { label: 'Floor Share', value: floorPct > 0 ? fmtPct(floorPct) : '—', cls: floorPct >= 40 ? 'positive' : floorPct >= 20 ? 'warning' : 'neutral' },
            ];

            document.getElementById('scoreboardGrid').innerHTML = items.map(i =>
                `<div class="sb-card"><div class="sb-value ${i.cls}">${i.value}</div><div class="sb-label">${i.label}</div></div>`
            ).join('');
        }

        // ---- WEEKLY ACTIONS (auto-generated) ----
        function renderWeeklyActions(cash, reserveFloor, topDebt, overdueAR, staleCash) {
            const actions = [];

            if (cash < reserveFloor) {
                actions.push({ icon: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>', cls: 'priority-high', text: `Build reserve: need $${(reserveFloor - cash).toLocaleString()} more before any extra debt payments.` });
            } else if (topDebt) {
                actions.push({ icon: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>', cls: 'priority-high', text: `Send extra payment to ${topDebt.lender} (${topDebt.apr}% APR). Every $100 saves $${(topDebt.apr / 12).toFixed(0)}/mo.` });
            }

            if (staleCash > 0) {
                actions.push({ icon: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>', cls: 'priority-med', text: `Deposit or reconcile ${staleCash} undeposited cash entries (>7 days old).` });
            }

            if (overdueAR && overdueAR > 2000) {
                actions.push({ icon: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg>', cls: 'priority-med', text: `Follow up on $${overdueAR.toLocaleString()} in overdue invoices.` });
            }

            // Always include one proactive action
            if (actions.length < 3) {
                actions.push({ icon: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>', cls: 'priority-low', text: 'Log all cash payments for the week. 10 minutes at end of each day.' });
            }
            if (actions.length < 3) {
                actions.push({ icon: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>', cls: 'priority-low', text: 'Tag floor graphics jobs in QuickBooks for accurate revenue-share tracking.' });
            }

            document.getElementById('weeklyActions').innerHTML = actions.slice(0, 3).map(a =>
                `<li class="${a.cls}"><span class="icon">${a.icon}</span><span>${a.text}</span></li>`
            ).join('');
        }

        // ---- DEBT TABLE (full) ----
        function renderDebtTable(debts) {
            const sorted = [...debts].sort((a, b) => b.apr - a.apr);
            const tbody = document.getElementById('debtBodyFull');
            tbody.innerHTML = sorted.map((d, i) => {
                const moInt = (d.balance * d.apr / 100 / 12);
                const rankCls = i === 0 ? 'r1' : i === 1 ? 'r2' : 'r3';
                return `<tr class="${i === 0 ? 'target' : ''}">
                    <td><span class="debt-rank ${rankCls}">${i + 1}</span></td>
                    <td>${d.lender}</td>
                    <td style="font-size:0.75rem;color:var(--text-muted);">${d.type.replace('_', ' ')}</td>
                    <td class="mono">${fmtFull(d.balance)}</td>
                    <td class="mono" style="color:var(--accent-red);">${d.apr}%</td>
                    <td class="mono">${fmtFull(d.minPmt)}</td>
                    <td class="mono" style="color:var(--accent-red);">${fmtFull(moInt)}</td>
                </tr>`;
            }).join('');

            // Totals
            const totalBal = sorted.reduce((s, d) => s + d.balance, 0);
            const totalMin = sorted.reduce((s, d) => s + d.minPmt, 0);
            const totalInt = sorted.reduce((s, d) => s + (d.balance * d.apr / 100 / 12), 0);
            tbody.innerHTML += `<tr style="font-weight:700;border-top:2px solid var(--glass-border);">
                <td></td><td>TOTAL</td><td></td>
                <td class="mono">${fmtFull(totalBal)}</td><td></td>
                <td class="mono">${fmtFull(totalMin)}</td>
                <td class="mono negative">${fmtFull(totalInt)}</td>
            </tr>`;

            // Reserve rule
            document.getElementById('reserveRule').innerHTML =
                totalBal > 0 ? `Cash < $20K → reserve only. Cash ≥ $26K → attack #1 (${sorted[0]?.lender || '?'} @ ${sorted[0]?.apr || '?'}%)` : 'No debts registered.';
        }

        // ---- CASH LOG ----
        function renderCashLog(log) {
            const el = document.getElementById('cashLogEntries');
            if (log.length === 0) {
                el.innerHTML = '<div style="color:var(--text-muted);font-size:0.85rem;text-align:center;padding:20px;">No entries yet. Tap + Add to start logging.</div>';
                document.getElementById('totalUndeposited').textContent = '$0';
                return;
            }

            // Sort by date descending
            const sorted = [...log].sort((a, b) => new Date(b.date) - new Date(a.date));
            el.innerHTML = sorted.map((e, i) => {
                const stale = !e.deposited && daysSince(e.date) > 7;
                const depBadge = e.deposited ? '[done]' : (stale ? '[overdue]' : '[pending]');
                return `<div class="log-entry" style="${stale ? 'border-color:rgba(224,72,72,0.3);' : ''}">
                    <span class="date">${new Date(e.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} ${depBadge}</span>
                    <span class="desc">${e.desc || e.jobType || '—'}</span>
                    <span class="amount positive">$${(e.amount || 0).toFixed(2)}</span>
                    <button class="del-btn" onclick="deleteCashEntry(${i})" title="Delete">✕</button>
                </div>`;
            }).join('');

            const total = log.filter(e => !e.deposited).reduce((s, e) => s + (e.amount || 0), 0);
            document.getElementById('totalUndeposited').textContent = fmtFull(total);
        }

        // ---- CASH MODAL ----
        function openCashModal() {
            document.getElementById('cashDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('cashDesc').value = '';
            document.getElementById('cashAmount').value = '';
            document.getElementById('cashJobType').value = 'floor_graphics';
            document.getElementById('cashNotes').value = '';
            document.getElementById('cashModal').classList.add('active');
        }
        function closeCashModal() { document.getElementById('cashModal').classList.remove('active'); }

        function saveCashEntry() {
            const entry = {
                id: 'CASH-' + Date.now(),
                date: document.getElementById('cashDate').value,
                desc: document.getElementById('cashDesc').value.trim(),
                amount: parseFloat(document.getElementById('cashAmount').value) || 0,
                jobType: document.getElementById('cashJobType').value,
                notes: document.getElementById('cashNotes').value.trim(),
                deposited: false,
                createdAt: new Date().toISOString()
            };
            if (entry.amount <= 0) return alert('Enter an amount > $0');
            if (!entry.date) return alert('Select a date');

            const log = loadCashLog();
            log.push(entry);
            saveCashLogToStore(log);
            closeCashModal();
            refreshData();
        }

        function deleteCashEntry(idx) {
            const log = loadCashLog();
            const sorted = [...log].sort((a, b) => new Date(b.date) - new Date(a.date));
            const toDelete = sorted[idx];
            const newLog = log.filter(e => e.id !== toDelete.id);
            saveCashLogToStore(newLog);
            refreshData();
        }

        // ---- DEBT MODAL ----
        function openDebtModal() {
            const debts = loadDebts();
            const el = document.getElementById('debtEditList');
            el.innerHTML = '';
            debts.forEach((d, i) => addDebtEditRow(d, i));
            document.getElementById('debtModal').classList.add('active');
        }
        function closeDebtModal() { document.getElementById('debtModal').classList.remove('active'); }

        function addDebtEditRow(d, idx) {
            const el = document.getElementById('debtEditList');
            const row = document.createElement('div');
            row.style.cssText = 'margin-bottom:12px;padding:12px;border-radius:12px;background:var(--card-bg);border:1px solid var(--glass-border);';
            row.innerHTML = `
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                    <span style="font-weight:600;font-size:0.85rem;">Debt #${(idx !== undefined ? idx : document.querySelectorAll('.debt-edit-card').length) + 1}</span>
                    <button class="del-btn" onclick="this.closest('div[style]').remove()" style="background:none;border:none;color:var(--accent-red);cursor:pointer;font-size:1rem;">✕</button>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
                    <div><label style="font-size:0.7rem;color:var(--text-muted);">Lender</label><input class="debt-lender" type="text" value="${d ? d.lender : ''}" placeholder="e.g. Chase" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--glass-border);background:var(--glass);color:var(--text);font-size:0.85rem;"></div>
                    <div><label style="font-size:0.7rem;color:var(--text-muted);">Type</label><select class="debt-type" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--glass-border);background:var(--glass);color:var(--text);font-size:0.85rem;">
                        <option value="credit_card" ${d && d.type === 'credit_card' ? 'selected' : ''}>Credit Card</option>
                        <option value="loc" ${d && d.type === 'loc' ? 'selected' : ''}>Line of Credit</option>
                        <option value="term_loan" ${d && d.type === 'term_loan' ? 'selected' : ''}>Term Loan</option>
                        <option value="tax" ${d && d.type === 'tax' ? 'selected' : ''}>Tax</option>
                    </select></div>
                    <div><label style="font-size:0.7rem;color:var(--text-muted);">Balance ($)</label><input class="debt-balance" type="number" value="${d ? d.balance : ''}" placeholder="0" step="100" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--glass-border);background:var(--glass);color:var(--text);font-size:0.85rem;"></div>
                    <div><label style="font-size:0.7rem;color:var(--text-muted);">APR (%)</label><input class="debt-apr" type="number" value="${d ? d.apr : ''}" placeholder="0" step="0.1" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--glass-border);background:var(--glass);color:var(--text);font-size:0.85rem;"></div>
                    <div><label style="font-size:0.7rem;color:var(--text-muted);">Min Payment ($)</label><input class="debt-min" type="number" value="${d ? d.minPmt : ''}" placeholder="0" step="10" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--glass-border);background:var(--glass);color:var(--text);font-size:0.85rem;"></div>
                </div>
            `;
            row.classList.add('debt-edit-card');
            el.appendChild(row);
        }

        function addDebtRow() { addDebtEditRow(null, document.querySelectorAll('.debt-edit-card').length); }

        function saveDebts() {
            const cards = document.querySelectorAll('.debt-edit-card');
            const debts = [];
            cards.forEach(card => {
                const lender = card.querySelector('.debt-lender').value.trim();
                const type = card.querySelector('.debt-type').value;
                const balance = parseFloat(card.querySelector('.debt-balance').value) || 0;
                const apr = parseFloat(card.querySelector('.debt-apr').value) || 0;
                const minPmt = parseFloat(card.querySelector('.debt-min').value) || 0;
                if (lender && balance > 0) debts.push({ lender, type, balance, apr, minPmt, status: 'active' });
            });
            saveDebtsToStore(debts);
            closeDebtModal();
            refreshData();
        }

        // ===== INIT =====
        refreshData();
    </script>
</body>
</html>
